{"version":3,"sources":["components/Login.js","components/TrackResult.js","components/Player.js","components/MainPage.js","components/useAuth.js","App.js","index.js"],"names":["Login","_jsx","Container","className","style","minHeight","children","href","TrackResult","_ref","track","chooseTrack","_jsxs","cursor","onClick","handleClick","src","albumUrl","alt","height","width","trackName","artistsName","Player","accessToken","trackUri","play","setPlay","useState","useEffect","SpotifyPlayer","token","showSaveIcon","callback","state","isPlaying","uris","spotifyApp","require","clientId","MainPage","code","search","setSearch","setAccessToken","refreshToken","setRefreshToken","expiresIn","setExpiresIn","axios","post","then","res","data","window","history","pushState","document","title","catch","location","useAuth","searchResult","setSearchResult","currentSong","setCurrentSong","lyrics","setLyrics","loading","setLoading","cancel","searchTracks","body","tracks","items","map","album","images","reduce","smallest","image","url","artists","name","uri","err","console","log","get","params","artist","type","placeholder","value","onChange","e","target","fontSize","class","overflowY","length","whiteSpace","URLSearchParams","App","ReactDOM","render","React","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.1f4b7899.chunk.js","sourcesContent":["import React from 'react';\nimport { Container } from 'react-bootstrap';\n\nconst AUTH_URL = \"https://accounts.spotify.com/authorize?client_id=f016625a8e2e4936a3cb2761f9b4f1ef&response_type=code&redirect_uri=https://spotify-clone-portfolio-3f8a1cecabc5.herokuapp.com/&scope=streaming%20user-read-private%20user-read-email%20user-library-read%20user-library-modify%20user-read-playback-state%20user-modify-playback-state\"\n\nfunction Login() {\n  return (\n    <Container className=\"d-flex justify-content-center align-items-center\" style={{ minHeight: \"100vh\" }}>\n        <a href={AUTH_URL} className=\"btn btn-success btn-lg\">Login with spotify</a>\n    </Container>\n    \n  );\n}\n\nexport default Login;\n","import React from 'react';\n\nexport default function TrackResult({track, chooseTrack}) {\n  const handleClick = () => {\n    chooseTrack(track);\n  }\n  return (\n    <div className=\"d-flex m-2 align-items-center\" style={{ cursor: \"pointer\" }} onClick={handleClick}>\n      <img src={track.albumUrl} alt=\"album images\" style={{height: \"64px\", width: \"64px\"}} />\n      <div className=\"ml-3\">\n        <div>{track.trackName}</div>\n        <div className=\"text-muted\">{track.artistsName}</div>\n      </div>\n    </div>\n  )\n}","import { useState, useEffect } from 'react';\nimport SpotifyPlayer from 'react-spotify-web-playback'; \n\nexport default function Player({accessToken, trackUri }) {\n  const [play, setPlay] = useState(false);\n\n  useEffect(() => {setPlay(true)}, [trackUri])\n  if (!accessToken) return null\n  return <SpotifyPlayer \n            token={accessToken} \n            showSaveIcon\n            callback={state => {\n              if(!state.isPlaying) setPlay(false);\n            }}\n            play={play}\n            uris={trackUri ? [trackUri] : []}\n          />\n}","import { useState, useEffect } from 'react';\nimport { Container } from 'react-bootstrap';\nimport axios from 'axios';\nimport TrackResult from './TrackResult';\nimport useAuth from './useAuth';\nimport Player from './Player';\nconst SpotifyWebApi = require('spotify-web-api-node');\n\n\nconst spotifyApp = new SpotifyWebApi({\n  clientId: 'f016625a8e2e4936a3cb2761f9b4f1ef'\n})\nexport default function MainPage({code}) {\n  const [search, setSearch] = useState(\"\");\n  const accessToken = useAuth(code);\n  const [searchResult, setSearchResult] = useState([]);\n  const [currentSong, setCurrentSong] = useState();\n  const [lyrics, setLyrics] = useState(\"\");\n  const [loading, setLoading] = useState(true);\n\n  function chooseTrack(track) {\n    setCurrentSong(track);\n    setSearch(\"\");\n    setLyrics(\"\");\n  }\n\n  useEffect(() => {\n    if(!accessToken) return;\n    spotifyApp.setAccessToken(accessToken);\n    setLoading(false);\n  }, [accessToken])\n\n  useEffect(() => {\n    if (!search) return setSearchResult([]);\n    if (!accessToken) return;\n\n    let cancel = false;\n    spotifyApp.searchTracks(search).then(data => {\n      if (cancel) return;\n      setSearchResult(\n        data.body.tracks.items.map(track => {\n        const smallestAlbumImage = track.album.images.reduce((smallest, image) => {\n          if (image.height < smallest.height) return image;\n          return smallest\n        }, track.album.images[0]) \n        return {\n          albumUrl: smallestAlbumImage.url,\n          artistsName: track.artists[0].name,\n          trackName: track.name,\n          uri: track.uri,\n        }\n      }))\n\n      return () => cancel = true;\n    })\n    .catch(err => console.log(err));\n  }, [search, accessToken])\n\n  useEffect(() => {\n    if(!currentSong) return;\n    if(process.env.NODE_ENV === 'development') {\n      axios.get('http://localhost:3001/lyrics', {\n        params: {\n          track: currentSong.trackName,\n          artist: currentSong.artistsName,\n        },\n      })\n      .then (res => {\n        setLyrics(res.data.lyrics.lyrics);\n      })\n      .catch(err => {\n        console.log(err);\n      })\n    }\n    else {\n      axios.get('/lyrics', {\n        params: {\n          track: currentSong.trackName,\n          artist: currentSong.artistsName,\n        },\n      })\n      .then (res => {\n        setLyrics(res.data.lyrics.lyrics);\n      })\n      .catch(err => {\n        console.log(err);\n      })\n    }\n  }, [currentSong])\n  return(\n    <Container className=\"d-flex flex-column py-2\" style={{ height: \"100vh\" }}>\n      <div className=\"input-group rounded\">\n        <input type=\"search\" className=\"form-control rounded\" placeholder=\"Search\" aria-label=\"Search\"\n          aria-describedby=\"search-addon\" value={search} onChange={e => setSearch(e.target.value)}/>\n      </div> \n\n      {loading ? \n        <div className=\"d-flex flex-column justify-content-center align-items-center\" style={{ height: \"100vh\"}}>\n          <p style={{ fontSize: \"2em\" }}><i class=\"fa fa-spinner fa-spin\"></i>  Loading</p>\n        </div> : \n        <div className=\"flex-grow-1 my-2\" style={{overflowY: \"auto\"}}>\n          {searchResult.map(track => (\n            <TrackResult track={track} chooseTrack={chooseTrack} key={track.uri} />\n          ))}\n\n          {searchResult.length === 0 && \n            <div className=\"text-center\" style={{whiteSpace: \"pre\"}}>\n            {lyrics}\n            </div>\n          }\n        </div> \n      }\n      \n      <div>\n        <Player accessToken={accessToken} trackUri={currentSong?.uri} />\n      </div>\n    </Container>\n    \n  )\n}","import {useState, useEffect} from 'react';\nimport axios from 'axios';\n\n\n\nexport default function useAuth(code) {\n  const [accessToken, setAccessToken] =useState();\n  const [refreshToken, setRefreshToken] =useState();\n  const [expiresIn, setExpiresIn] =useState();\n\n  useEffect(() => {\n    if(process.env.NODE_ENV === 'development') {\n      axios.post('http://localhost:3001/login', {\n        code\n      })\n      .then(res => {\n        setAccessToken(res.data.accessToken);\n        setRefreshToken(res.data.refreshToken);\n        setExpiresIn(res.data.expiresIn);\n\n        window.history.pushState({}, document.title, \"/\");\n      })\n      .catch(() => {\n        window.location = \"/\"\n      })\n    }\n    else {\n      axios.post('/login', {\n        code\n      })\n      .then(res => {\n        setAccessToken(res.data.accessToken);\n        setRefreshToken(res.data.refreshToken);\n        setExpiresIn(res.data.expiresIn);\n\n        window.history.pushState({}, document.title, \"/\");\n      })\n      .catch(() => {\n        window.location = \"/\"\n      })\n    }\n  }, [code]); // run this useEffect everytime the code change\n\n  useEffect(() => {\n    if(!refreshToken || !expiresIn) return // return early if there is no refresh token or expires in\n    if(process.env.NODE_ENV === 'development') {\n      axios.post('http://localhost:3001/refresh', {\n        refreshToken\n      })\n      .then(res => {\n        setAccessToken(res.data.accessToken);\n        setExpiresIn(res.data.expiresIn);\n      })\n      .catch(() => {\n        window.location = \"/\"\n      })\n    }\n    else {\n      axios.post('/refresh', {\n        refreshToken\n      })\n      .then(res => {\n        setAccessToken(res.data.accessToken);\n        setExpiresIn(res.data.expiresIn);\n      })\n      .catch(() => {\n        window.location = \"/\"\n      })\n    }\n  }, [refreshToken, expiresIn]) // access the refresh API endpoint if the token is about to expires\n\n  return accessToken;\n}","import React from 'react';\nimport Login from './components/Login';\nimport MainPage from './components/MainPage';\nimport 'bootstrap/dist/css/bootstrap.min.css';\n\nconst params = new URLSearchParams(window.location.search);\nconst code = params.get('code');\n\n\nfunction App() {\n  return (\n    code ? <MainPage code={code} /> : <Login />\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}